<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Quest: 100 Levels Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #58cc02; --blue: #1cb0f6; --error: #ff4b4b; --gray: #e5e5e5; --text: #4b4b4b; }
        body { font-family: 'Nunito', sans-serif; margin: 0; background: #fff; overflow-x: hidden; }
        
        /* Dashboard */
        .header { position: sticky; top: 0; background: white; border-bottom: 2px solid var(--gray); padding: 15px; display: flex; justify-content: space-around; z-index: 100; }
        .stat { font-weight: 900; font-size: 1.2rem; }

        /* Path Generator */
        .path { display: flex; flex-direction: column-reverse; align-items: center; padding: 50px 0; background: #f7f7f7; }
        .node { 
            width: 70px; height: 70px; border-radius: 50%; border: none; 
            margin: 15px 0; cursor: pointer; font-weight: 900; color: white;
            transition: 0.2s; position: relative;
        }
        .node.locked { background: var(--gray); box-shadow: 0 6px 0 #afafaf; }
        .node.unlocked { background: var(--primary); box-shadow: 0 6px 0 var(--primary-dark); }
        .node.active { transform: scale(1.2); border: 4px solid var(--blue); }
        
        /* Jump Feature */
        .jump-zone { position: fixed; bottom: 20px; right: 20px; z-index: 50; }
        .btn-jump { background: var(--blue); color: white; border: none; padding: 15px; border-radius: 20px; font-weight: 900; cursor: pointer; box-shadow: 0 4px 0 #1899d6; }

        /* Lesson UI */
        .overlay { position: fixed; inset: 0; background: white; display: none; flex-direction: column; z-index: 200; }
        .progress-bar { height: 12px; background: var(--gray); border-radius: 6px; margin: 20px; flex-grow: 1; }
        .progress-inner { height: 100%; background: var(--primary); width: 0%; transition: 0.3s; }
        .content { padding: 40px 20px; text-align: center; max-width: 500px; margin: 0 auto; }
        .option { 
            display: block; width: 100%; padding: 15px; margin: 10px 0; 
            border: 2px solid var(--gray); border-radius: 12px; background: white;
            font-size: 1.1rem; cursor: pointer; font-family: inherit;
        }
        .option.correct { background: #dcfce7; border-color: var(--primary); }
        .option.wrong { background: #fee2e2; border-color: var(--error); }
    </style>
</head>
<body>

    <div class="header">
        <div class="stat" style="color:#ffc800">‚≠ê LVL: <span id="current-lvl-display">1</span></div>
        <div class="stat" style="color:var(--error)">‚ù§Ô∏è <span id="hearts">5</span></div>
    </div>

    <div class="path" id="level-path"></div>

    <div class="jump-zone">
        <button class="btn-jump" onclick="triggerJumpTest()">SKIP 10 LEVELS ‚ö°</button>
    </div>

    <div class="overlay" id="overlay">
        <div style="display:flex; align-items:center; padding: 10px;">
            <button onclick="closeLesson()" style="border:none; background:none; font-size:2rem; cursor:pointer">√ó</button>
            <div class="progress-bar"><div class="progress-inner" id="progress-fill"></div></div>
        </div>
        <div class="content" id="lesson-content"></div>
    </div>

<script>
    // Configuraci√≥n del Motor
    let userLevel = parseInt(localStorage.getItem('userLvl')) || 1;
    let hearts = 5;
    let currentSessionLvl = 1;
    let sessionSteps = 0;

    const database = [
        { q: "I'm looking forward to ___ you.", a: ["see", "seeing", "seen"], c: 1, lvl: 1 },
        { q: "If I ___ more time, I'd travel.", a: ["have", "had", "would have"], c: 1, lvl: 5 },
        { q: "By next year, I ___ my degree.", a: ["will finish", "will have finished", "finish"], c: 1, lvl: 15 },
        { q: "Hardly ___ the door when it rained.", a: ["I opened", "did I open", "had I opened"], c: 2, lvl: 40 }
    ];

    function generatePath() {
        const path = document.getElementById('level-path');
        path.innerHTML = '';
        for(let i = 1; i <= 100; i++) {
            const node = document.createElement('button');
            node.className = `node ${i <= userLevel ? 'unlocked' : 'locked'} ${i === userLevel ? 'active' : ''}`;
            node.innerHTML = i;
            node.onclick = () => startLevel(i);
            // Efecto zig-zag
            node.style.marginLeft = `${Math.sin(i) * 50}px`;
            path.appendChild(node);
        }
        document.getElementById('current-lvl-display').innerText = userLevel;
        window.scrollTo(0, document.body.scrollHeight);
    }

    function startLevel(lvl, isJump = false) {
        if(lvl > userLevel && !isJump) return;
        currentSessionLvl = lvl;
        sessionSteps = 0;
        document.getElementById('overlay').style.display = 'flex';
        renderQuestion(isJump);
    }

    function renderQuestion(isJump) {
        // Generador Procedural: busca preguntas cerca del nivel o genera una gen√©rica
        const pool = database.filter(d => d.lvl <= currentSessionLvl);
        const question = pool[Math.floor(Math.random() * pool.length)];
        
        const content = document.getElementById('lesson-content');
        content.innerHTML = `
            <h2>${isJump ? 'üöÄ JUMP TEST' : 'Level ' + currentSessionLvl}</h2>
            <p class="stat">${question.q}</p>
            <div id="options-grid">
                ${question.a.map((opt, i) => `
                    <button class="option" onclick="evalAns(this, ${i}, ${question.c}, ${isJump})">${opt}</button>
                `).join('')}
            </div>
        `;
    }

    function evalAns(btn, selected, correct, isJump) {
        if(selected === correct) {
            btn.classList.add('correct');
            setTimeout(() => {
                if(isJump) {
                    userLevel = Math.min(100, userLevel + 10);
                    localStorage.setItem('userLvl', userLevel);
                    closeLesson();
                    generatePath();
                } else {
                    userLevel = Math.max(userLevel, currentSessionLvl + 1);
                    localStorage.setItem('userLvl', userLevel);
                    closeLesson();
                    generatePath();
                }
            }, 500);
        } else {
            btn.classList.add('wrong');
            hearts--;
            document.getElementById('hearts').innerText = hearts;
            if(isJump) { 
                alert("JUMP FAILED! You lost your chance."); 
                hearts = 0;
                location.reload(); 
            }
        }
    }

    function triggerJumpTest() {
        if(confirm("Si fallas el test de salto, perder√°s todas tus vidas. ¬øAceptas el reto?")) {
            startLevel(userLevel + 10, true);
        }
    }

    function closeLesson() { document.getElementById('overlay').style.display = 'none'; }
    
    generatePath();
</script>
</body>
</html>
